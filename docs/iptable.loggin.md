# iptable.loggin.py - Sistema de Logging y An√°lisis de Ataques

## Tabla de Contenidos

- [Descripci√≥n General](#descripci√≥n-general)
- [Instalaci√≥n y Dependencias](#instalaci√≥n-y-dependencias)
- [Configuraci√≥n Inicial](#configuraci√≥n-inicial)
- [Uso del Script](#uso-del-script)
- [Tipos de An√°lisis](#tipos-de-an√°lisis)
- [Estructura de Reportes JSON](#estructura-de-reportes-json)
- [Patrones de Ataque Detectados](#patrones-de-ataque-detectados)
- [Interpretaci√≥n de Resultados](#interpretaci√≥n-de-resultados)
- [Troubleshooting](#troubleshooting)

## Descripci√≥n General

`iptable.loggin.py` es una herramienta avanzada de an√°lisis de logs para iptables espec√≠ficamente dise√±ada para servidores L4D2. Proporciona capacidades de logging autom√°tico, an√°lisis temporal detallado y generaci√≥n de reportes JSON comprehensivos sobre diferentes tipos de ataques DDoS.

### Caracter√≠sticas Principales

- **Configuraci√≥n autom√°tica de rsyslog** para capturar logs de iptables
- **An√°lisis temporal avanzado** con m√∫ltiples perspectivas (IP, puerto, d√≠a, semana, mes, tipo de ataque)
- **Generaci√≥n de reportes JSON** detallados para an√°lisis posterior
- **Detecci√≥n de patrones espec√≠ficos** de ataques a servidores L4D2
- **Gesti√≥n de permisos** automatizada para acceso a logs del sistema
- **Integraci√≥n completa** con `iptables.rules.sh`

## Instalaci√≥n y Dependencias

### Requisitos del Sistema

- **Sistema Operativo**: Linux (Ubuntu 18.04+, Debian 9+, CentOS 7+)
- **Python**: 3.6 o superior
- **Permisos**: sudo/root para configuraci√≥n de rsyslog y acceso a logs
- **Memoria**: M√≠nimo 512MB RAM libre para an√°lisis de logs grandes

### Instalaci√≥n de Dependencias

#### 1. Instalar Python 3 y pip

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install python3 python3-pip

# CentOS/RHEL
sudo yum install python3 python3-pip
# o para versiones m√°s nuevas:
sudo dnf install python3 python3-pip
```

### Instalaci√≥n de Dependencias

#### M√©todo 1: Instalaci√≥n Directa en el Servidor

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install python3 python3-pip python3-pandas python3-dotenv

# CentOS/RHEL 8+
sudo dnf install python3 python3-pip python3-pandas python3-python-dotenv

# CentOS/RHEL 7
sudo yum install python3 python3-pip
sudo pip3 install pandas python-dotenv

# Verificar instalaci√≥n
python3 -c "import pandas, dotenv; print('‚úÖ Dependencias instaladas correctamente')"
```

#### M√©todo 2: Instalaci√≥n con pip

```bash
# Instalar paquetes requeridos con pip
sudo pip3 install pandas>=1.3.0 python-dotenv>=0.19.0

# Verificar instalaci√≥n
python3 -c "import pandas, dotenv; print('‚úÖ Dependencias instaladas correctamente')"
```

#### M√©todo 3: Entorno Virtual

Para desarrollo, testing o si prefieres mantener las dependencias aisladas del sistema, puedes usar el gestor de entorno virtual incluido. Ver documentaci√≥n detallada: [Gestor de Entorno Virtual](venv.loggin.md)

```bash
# Ejecutar el gestor de entorno virtual
./venv.loggin.sh

# Seguir las opciones del men√∫ interactivo
# Opci√≥n 1: Instalar entorno virtual
# Opci√≥n 2: Activar y usar el script
```

#### 3. Descargar el Script

```bash
# Clonar el repositorio completo
git clone https://github.com/AoC-Gamers/L4D2-Iptable-Suite.git
cd L4D2-Iptable-Suite

# O descargar solo el script
wget https://raw.githubusercontent.com/AoC-Gamers/L4D2-Iptable-Suite/main/iptable.loggin.py
chmod +x iptable.loggin.py
```

## Gestor de Entorno Virtual

Para facilitar la gesti√≥n de dependencias y el desarrollo en diferentes entornos, el proyecto incluye un gestor de entorno virtual autom√°tico (`venv.loggin.sh`). Este script proporciona una interfaz interactiva para:

- **Instalaci√≥n autom√°tica** de entorno virtual Python
- **Gesti√≥n de dependencias** aisladas del sistema
- **Compatibilidad multiplataforma** (Linux, Windows, macOS)
- **Verificaci√≥n autom√°tica** de dependencias
- **Activaci√≥n/desactivaci√≥n** simplificada

### Uso R√°pido

```bash
# Ejecutar el gestor
./venv.loggin.sh

# Seleccionar opciones del men√∫:
# 1. Instalar entorno virtual
# 2. Activar y usar el script
```

**Documentaci√≥n completa**: [Gestor de Entorno Virtual - venv.loggin.md](venv.loggin.md)

**Cu√°ndo usar el entorno virtual:**
- üß™ **Desarrollo y testing**
- üîí **Ambientes con restricciones de instalaci√≥n global**
- üñ•Ô∏è **Sistemas Windows con bash**
- üì¶ **M√∫ltiples versiones de Python en el sistema**

---

### 1. Archivo de Configuraci√≥n (.env)

El script utiliza el mismo archivo `.env` que `iptables.rules.sh`. Aseg√∫rate de tener configuradas las siguientes variables relacionadas con logging:

```bash
# Configuraci√≥n de Logging
LOGFILE=/var/log/l4d2-iptables.log
RSYSLOG_CONF=/etc/rsyslog.d/l4d2-iptables.conf

# Prefijos de Log para Diferentes Tipos de Ataque
LOG_PREFIX_INVALID_SIZE=\"INVALID_SIZE: \"
LOG_PREFIX_MALFORMED=\"MALFORMED: \"
LOG_PREFIX_A2S_INFO=\"A2S_INFO_FLOOD: \"
LOG_PREFIX_A2S_PLAYERS=\"A2S_PLAYERS_FLOOD: \"
LOG_PREFIX_A2S_RULES=\"A2S_RULES_FLOOD: \"
LOG_PREFIX_STEAM_GROUP=\"STEAM_GROUP_FLOOD: \"
LOG_PREFIX_L4D2_CONNECT=\"L4D2_CONNECT_FLOOD: \"
LOG_PREFIX_L4D2_RESERVE=\"L4D2_RESERVE_FLOOD: \"
LOG_PREFIX_UDP_NEW_LIMIT=\"UDP_NEW_LIMIT: \"
LOG_PREFIX_UDP_EST_LIMIT=\"UDP_EST_LIMIT: \"
LOG_PREFIX_TCP_RCON_BLOCK=\"TCP_RCON_BLOCK: \"
LOG_PREFIX_ICMP_FLOOD=\"ICMP_FLOOD: \"

# Configuraci√≥n de Puertos (para clasificaci√≥n en reportes)
GAMESERVERPORTS=\"27015\"
TVSERVERPORTS=\"27020\"
```

### 2. Configuraci√≥n de Permisos

Para que el script pueda acceder a los logs del sistema, el usuario debe tener permisos adecuados:

```bash
# Agregar usuario al grupo 'adm' (para acceso a logs)
sudo usermod -a -G adm $USER

# Reiniciar sesi√≥n o aplicar cambios de grupo
newgrp adm

# Verificar permisos
id | grep adm
```

## Uso del Script

### M√©todos de Ejecuci√≥n

#### M√©todo 1: Con Entorno Virtual (Recomendado)

```bash
# Usar el gestor de entorno virtual para ejecuci√≥n autom√°tica
./venv.loggin.sh

# Seleccionar opci√≥n 6: üêç Run iptable.loggin.py script
# El script maneja autom√°ticamente:
# - Detecci√≥n de OS (Windows/Linux)
# - Uso de sudo solo cuando es necesario (Linux)
# - Verificaci√≥n de dependencias
# - Ruta completa del Python del entorno virtual
```

**Ventajas del m√©todo de entorno virtual:**
- ‚úÖ **Multiplataforma**: Funciona en Windows, Linux y macOS
- ‚úÖ **Manejo autom√°tico de sudo**: Solo en Linux cuando es necesario
- ‚úÖ **Dependencias aisladas**: No afecta el sistema global
- ‚úÖ **Verificaci√≥n autom√°tica**: Confirma que todo est√© listo antes de ejecutar
- ‚úÖ **Sin configuraci√≥n manual**: El script maneja todo autom√°ticamente

#### M√©todo 2: Ejecuci√≥n Directa (Tradicional)

```bash
# Ejecutar con archivo .env en el directorio actual
sudo python3 iptable.loggin.py

# Ejecutar especificando ruta del archivo .env
sudo python3 iptable.loggin.py --env-file /ruta/al/archivo/.env

# Ejecutar desde cualquier directorio
sudo python3 /ruta/completa/iptable.loggin.py --env-file /ruta/al/.env
```

#### M√©todo 3: Con Entorno Virtual Activado Manualmente

```bash
# Activar el entorno virtual
./venv.loggin.sh
# Opci√≥n 2: Activate virtual environment

# En el shell interactivo del entorno virtual:
sudo python iptable.loggin.py --env-file .env

# Salir del entorno
deactivate
```

### Men√∫ Interactivo

Al ejecutar el script, se presenta un men√∫ con las siguientes opciones:

```
=====================================
       L4D2 IPTABLES LOG MANAGER    
=====================================
1 - Install rsyslog and configure L4D2 logging
2 - Check user permissions for log reading
3 - Add 'adm' group permissions to current user
4 - Analyze logs and generate reports
5 - Exit
=====================================
```

#### Opci√≥n 1: Instalar rsyslog y Configurar Logging

Esta opci√≥n realiza autom√°ticamente:

- **Instalaci√≥n de rsyslog** (si no est√° presente)
- **Configuraci√≥n autom√°tica** del archivo rsyslog para L4D2
- **Creaci√≥n de reglas de filtrado** basadas en los prefijos definidos en `.env`
- **Reinicio del servicio rsyslog** para aplicar cambios

```bash
# Archivo generado: /etc/rsyslog.d/l4d2-iptables.conf
# Contenido t√≠pico:
:msg, contains, "INVALID_SIZE: " /var/log/l4d2-iptables.log
:msg, contains, "A2S_INFO_FLOOD: " /var/log/l4d2-iptables.log
# ... etc para todos los prefijos
& stop
```

#### Opci√≥n 2: Verificar Permisos de Usuario

Verifica si el usuario actual tiene permisos para leer los logs del sistema:

- Revisa membres√≠a en grupo 'adm'
- Verifica acceso al archivo de log
- Proporciona diagn√≥stico de problemas de permisos

#### Opci√≥n 3: Agregar Permisos de Grupo 'adm'

Agrega autom√°ticamente el usuario actual al grupo 'adm' para acceso a logs del sistema.

#### Opci√≥n 4: Analizar Logs y Generar Reportes

Presenta un submen√∫ para seleccionar el tipo de an√°lisis:

```
=== ANALYSIS TYPE ===
1. Summary by IP (detailed structure with multiple dates)
2. Summary by Port (port-focused with top attackers)
3. Summary by Day (daily breakdown with time distribution)
4. Summary by Week (weekly analysis with percentages)
5. Summary by Month (monthly comprehensive stats)
6. Summary by Attack Type (attack pattern analysis)
7. Generate ALL reports (all analysis types)
8. Cancel
```

## Tipos de An√°lisis

### 1. An√°lisis por IP (`summary_by_ip.json`)

Proporciona una vista detallada de la actividad de cada IP atacante:

**Informaci√≥n incluida:**
- **Actividad por fecha**: Timeline detallado para cada d√≠a
- **Estad√≠sticas totales**: Conteo total de eventos por tipo de ataque
- **Puertos afectados**: Separaci√≥n entre GameServer y SourceTV
- **Duraci√≥n de ataques**: Tiempo entre primer y √∫ltimo evento

**Caso de uso**: Identificar atacantes persistentes y patrones de comportamiento espec√≠ficos.

### 2. An√°lisis por Puerto (`summary_by_port.json`)

Agrupa los ataques por puerto de destino:

**Informaci√≥n incluida:**
- **Tipo de puerto**: GameServer, SourceTV u Other
- **Breakdown de eventos**: Tipos de ataques por puerto
- **Top atacantes**: IPs m√°s activas contra cada puerto
- **Ventana temporal**: Duraci√≥n de ataques por puerto

**Caso de uso**: Identificar qu√© puertos son m√°s vulnerables y requieren protecci√≥n adicional.

### 3. An√°lisis por D√≠a (`summary_by_day.json`)

Proporciona una vista diaria de la actividad de ataques:

**Informaci√≥n incluida:**
- **Eventos totales por d√≠a**
- **Breakdown por puerto y tipo de ataque**
- **Distribuci√≥n temporal por horas**
- **Top atacantes por d√≠a**

**Caso de uso**: Identificar patrones temporales y picos de actividad maliciosa.

### 4. An√°lisis por Semana (`summary_by_week.json`)

Vista semanal con an√°lisis estad√≠stico:

**Informaci√≥n incluida:**
- **Totales semanales con porcentajes**
- **Distribuci√≥n de tipos de ataque**
- **An√°lisis de puertos por semana**
- **Tendencias temporales**

**Caso de uso**: An√°lisis de tendencias a mediano plazo y planificaci√≥n de defensas.

### 5. An√°lisis por Mes (`summary_by_month.json`)

An√°lisis mensual comprehensivo:

**Informaci√≥n incluida:**
- **Estad√≠sticas mensuales completas**
- **Porcentajes de distribuci√≥n de ataques**
- **An√°lisis de puertos con porcentajes**
- **Comparativas mes a mes**

**Caso de uso**: Reportes ejecutivos y an√°lisis de tendencias a largo plazo.

### 6. An√°lisis por Tipo de Ataque (`summary_by_attack_type.json`)

Categorizaci√≥n por patr√≥n de ataque:

**Informaci√≥n incluida:**
- **Conteo total por tipo de ataque**
- **Porcentaje del total de eventos**
- **Distribuci√≥n por tipos de puerto**
- **D√≠as con actividad por tipo**

**Caso de uso**: Identificar los tipos de ataques m√°s comunes y ajustar defensas espec√≠ficas.

## Estructura de Reportes JSON

Todos los reportes generados siguen una estructura JSON bien definida que facilita su procesamiento automatizado y an√°lisis posterior. Los archivos se generan en la carpeta `summary_example/` del repositorio.

### Ejemplos de Estructura

Para ver ejemplos detallados de cada tipo de reporte, consulta los archivos de ejemplo:

- **An√°lisis por IP**: Ver [summary_by_ip.json](../summary_example/summary_by_ip.json)
- **An√°lisis por Puerto**: Ver [summary_by_port.json](../summary_example/summary_by_port.json)  
- **An√°lisis por D√≠a**: Ver [summary_by_day.json](../summary_example/summary_by_day.json)
- **An√°lisis por Semana**: Ver [summary_by_week.json](../summary_example/summary_by_week.json)
- **An√°lisis por Mes**: Ver [summary_by_month.json](../summary_example/summary_by_month.json)
- **An√°lisis por Tipo de Ataque**: Ver [summary_by_attack_type.json](../summary_example/summary_by_attack_type.json)

### Caracter√≠sticas Comunes de los Reportes

Todos los reportes JSON incluyen:
- **Timestamps**: Fechas y horas en formato ISO para f√°cil parsing
- **Contadores**: N√∫meros exactos de eventos por categor√≠a
- **Porcentajes**: Distribuci√≥n relativa para an√°lisis estad√≠stico
- **Metadatos**: Informaci√≥n contextual sobre puertos, IPs y duraciones
- **Estructura jer√°rquica**: Organizaci√≥n l√≥gica para navegaci√≥n eficiente

## Patrones de Ataque Detectados

### Ataques de Validaci√≥n de Paquetes

#### INVALID_SIZE
- **Descripci√≥n**: Paquetes UDP con tama√±os espec√≠ficos usados en ataques
- **Detalles t√©cnicos**: Ver [Ataques de Validaci√≥n de Paquetes](iptables.rules.md#ataques-validacion-paquetes)

#### MALFORMED
- **Descripci√≥n**: Paquetes UDP malformados o con contenido inv√°lido
- **Detalles t√©cnicos**: Ver [Ataques de Validaci√≥n de Paquetes](iptables.rules.md#ataques-validacion-paquetes)

### Ataques de Consulta A2S (Server Query)

#### A2S_INFO_FLOOD
- **Descripci√≥n**: Flood de consultas A2S_INFO (0x54)
- **Puertos afectados**: Solo GameServer (no SourceTV)
- **Detalles t√©cnicos**: Ver [Ataques de Consulta A2S](iptables.rules.md#ataques-consulta-a2s)

#### A2S_PLAYERS_FLOOD
- **Descripci√≥n**: Flood de consultas A2S_PLAYERS (0x55)
- **Puertos afectados**: Solo GameServer
- **Detalles t√©cnicos**: Ver [Ataques de Consulta A2S](iptables.rules.md#ataques-consulta-a2s)

#### A2S_RULES_FLOOD
- **Descripci√≥n**: Flood de consultas A2S_RULES (0x56)
- **Puertos afectados**: Solo GameServer
- **Detalles t√©cnicos**: Ver [Ataques de Consulta A2S](iptables.rules.md#ataques-consulta-a2s)

### Ataques Espec√≠ficos de L4D2

#### L4D2_CONNECT_FLOOD
- **Descripci√≥n**: Flood de paquetes con string "connect"
- **Prop√≥sito**: Saturar el proceso de conexi√≥n de jugadores
- **Impacto**: Puede prevenir conexiones leg√≠timas
- **Mitigaci√≥n**: Rate limiting espec√≠fico por IP
- **Detalles t√©cnicos**: Ver [Ataques Espec√≠ficos de L4D2](iptables.rules.md#ataques-especificos-l4d2)

#### L4D2_RESERVE_FLOOD
- **Descripci√≥n**: Flood de paquetes con string "reserve"
- **Prop√≥sito**: Atacar el sistema de reserva de slots
- **Impacto**: Puede causar inestabilidad en lobby management
- **Mitigaci√≥n**: Rate limiting estricto
- **Detalles t√©cnicos**: Ver [Ataques Espec√≠ficos de L4D2](iptables.rules.md#ataques-especificos-l4d2)

### Ataques de Limitaci√≥n UDP

#### UDP_NEW_LIMIT y UDP_EST_LIMIT
- **Descripci√≥n**: Protecci√≥n contra floods UDP en conexiones nuevas y establecidas
- **Detalles t√©cnicos**: Ver [Ataques de Rate Limiting UDP](iptables.rules.md#ataques-rate-limiting-udp)
- **Configuraci√≥n**: Basada en `CMD_LIMIT` y algoritmos hashlimit espec√≠ficos

### Otros Ataques

#### STEAM_GROUP_FLOOD
- **Descripci√≥n**: Flood de consultas relacionadas con grupos Steam
- **Prop√≥sito**: Saturar consultas de informaci√≥n de grupos
- **Impacto**: Consumo de recursos del servidor Steam API
- **Mitigaci√≥n**: Rate limiting espec√≠fico
- **Detalles t√©cnicos**: Ver [Ataques de Consulta A2S](iptables.rules.md#ataques-consulta-a2s)

#### TCP_RCON_BLOCK
- **Descripci√≥n**: Bloqueo de conexiones TCP maliciosas
- **Prop√≥sito**: Proteger puertos RCON de spam/brute force
- **Impacto**: Previene ataques administrativos
- **Mitigaci√≥n**: Bloqueo completo o rate limiting seg√∫n configuraci√≥n
- **Detalles t√©cnicos**: Ver [Ataques TCP/RCON](iptables.rules.md#ataques-tcp-rcon)

#### ICMP_FLOOD
- **Descripci√≥n**: Flood de pings ICMP
- **Prop√≥sito**: Saturar conectividad de red
- **Impacto**: Degradaci√≥n general de performance de red
- **Mitigaci√≥n**: Rate limiting de paquetes ICMP
- **Detalles t√©cnicos**: Ver [Ataques ICMP/Ping Flood](iptables.rules.md#ataques-icmp-ping-flood)

## Interpretaci√≥n de Resultados

### An√°lisis de Severidad

#### Ataques de Alta Severidad
- **A2S_RULES_FLOOD**: Respuesta muy grande, alto impacto en bandwidth
- **L4D2_CONNECT_FLOOD**: Puede prevenir conexiones leg√≠timas
- **TCP_RCON_BLOCK**: Intentos de comprometer administraci√≥n

#### Ataques de Severidad Media
- **A2S_INFO_FLOOD / A2S_PLAYERS_FLOOD**: Impacto moderado en recursos
- **UDP_EST_LIMIT**: Afecta jugadores conectados
- **STEAM_GROUP_FLOOD**: Impacto en funcionalidades sociales

#### Ataques de Baja Severidad
- **INVALID_SIZE / MALFORMED**: Filtrados autom√°ticamente
- **UDP_NEW_LIMIT**: Protecci√≥n preventiva
- **ICMP_FLOOD**: Impacto m√≠nimo si est√° bien limitado

### Recomendaciones por Patr√≥n

#### Si predominan ataques A2S:
```bash
# Ajustar l√≠mites m√°s estrictos en .env
CMD_LIMIT=60  # Reducir de 100 a 60
```

#### Si hay muchos TCP_RCON_BLOCK:
```bash
# Habilitar protecci√≥n TCP completa
ENABLE_TCP_PROTECT=true
TCP_PROTECTION=\"27015:27020\"
```

#### Si hay ataques persistentes de una IP:
```bash
# Agregar a whitelist si es leg√≠tima (acceso completo al sistema)
WHITELISTED_IPS=\"IP_CONFIABLE1 IP_CONFIABLE2\"
```

### Umbrales de Alerta

- **> 1000 eventos/d√≠a por IP**: Investigar comportamiento
- **> 50% de un tipo de ataque**: Ajustar defensas espec√≠ficas
- **Duraci√≥n > 1 hora**: Posible ataque coordinado
- **> 10 IPs diferentes en 1 hora**: Posible botnet

## Troubleshooting

### Problemas Comunes

#### \"Permission denied\" al acceder a logs

**S√≠ntomas**:
```
‚ùå Error: Permission denied reading /var/log/l4d2-iptables.log
```

**Soluci√≥n**:
```bash
# Verificar permisos del archivo
ls -la /var/log/l4d2-iptables.log

# Agregar usuario a grupo adm
sudo usermod -a -G adm $USER
newgrp adm

# Si persiste, ajustar permisos del archivo
sudo chmod 644 /var/log/l4d2-iptables.log
```

#### Archivo de log no se genera

**S√≠ntomas**:
- El archivo `/var/log/l4d2-iptables.log` no existe
- Los reportes est√°n vac√≠os

**Diagn√≥stico**:
```bash
# Verificar configuraci√≥n de rsyslog
sudo systemctl status rsyslog
cat /etc/rsyslog.d/l4d2-iptables.conf

# Verificar logs de sistema
sudo journalctl -u rsyslog -f
```

**Soluci√≥n**:
```bash
# Reconfigurar rsyslog usando el script
sudo python3 iptable.loggin.py
# Seleccionar opci√≥n 1

# Reiniciar rsyslog
sudo systemctl restart rsyslog

# Generar tr√°fico de prueba para verificar logging
# (ejecutar iptables.rules.sh primero)
```

#### Dependencias de Python faltantes

**S√≠ntomas**:
```python
ModuleNotFoundError: No module named 'pandas'
```

**Soluci√≥n**:
```bash
# Instalar dependencias
sudo pip3 install pandas python-dotenv

# Verificar instalaci√≥n
python3 -c \"import pandas, dotenv; print('OK')\"
```

#### Reportes JSON vac√≠os o incompletos

**S√≠ntomas**:
- Archivos JSON generados pero con arrays vac√≠os
- Conteos de eventos en 0

**Posibles causas**:
1. **Prefijos de log incorrectos** en .env
2. **iptables.rules.sh no ejecutado** previamente
3. **No hay tr√°fico de ataque** registrado a√∫n

**Soluci√≥n**:
```bash
# Verificar que existen logs
sudo tail -20 /var/log/l4d2-iptables.log

# Verificar prefijos en .env coinciden con iptables.rules.sh
grep LOG_PREFIX .env

# Generar tr√°fico de prueba (opcional, solo para testing)
# Nota: NO hacer en producci√≥n
```

#### Error de configuraci√≥n de .env

**S√≠ntomas**:
```
‚ùå .env file not found: /path/to/.env
```

**Soluci√≥n**:
```bash
# Especificar ruta correcta del archivo .env
sudo python3 iptable.loggin.py --env-file /ruta/correcta/.env

# O copiar example.env como .env
cp example.env .env
```

### Verificaci√≥n de Configuraci√≥n

Para verificar que el sistema de logging est√© funcionando correctamente, puedes usar los siguientes comandos:

```bash
# Verificar estado de rsyslog
sudo systemctl status rsyslog

# Verificar configuraci√≥n L4D2
cat /etc/rsyslog.d/l4d2-iptables.conf

# Verificar permisos de usuario
id | grep adm

# Verificar contenido del log
sudo tail -10 /var/log/l4d2-iptables.log
```

### Optimizaci√≥n de Performance

Para logs muy grandes (>100MB), el script autom√°ticamente optimiza el an√°lisis procesando los datos por chunks. Si necesitas analizar solo eventos recientes, puedes pre-filtrar:

```bash
# Analizar solo eventos del d√≠a actual
sudo grep "$(date +%Y-%m-%d)" /var/log/l4d2-iptables.log > /tmp/today-attacks.log
```

Para configurar rotaci√≥n autom√°tica de logs y evitar que crezcan demasiado:

```bash
# Configurar logrotate para L4D2
sudo tee /etc/logrotate.d/l4d2-iptables > /dev/null << EOF
/var/log/l4d2-iptables.log {
    daily
    rotate 7
    compress
    delaycompress
    create 644 root adm
    postrotate
        systemctl reload rsyslog
    endscript
}
EOF
```

---

## Enlaces Relacionados

- [README Principal](../README.md)
- [Gestor de Entorno Virtual - venv.loggin.sh](venv.loggin.md)
- [Documentaci√≥n iptables.rules.sh](iptables.rules.md)
- [Documentaci√≥n ipp.sh](ipp.md)
- [Archivo de Configuraci√≥n example.env](../example.env)

---

*Documentaci√≥n actualizada para L4D2 IPTables Suite v2.4*
